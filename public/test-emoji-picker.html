<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Emoji Picker</title>
    <link rel="stylesheet" href="/css/index.css">
    <style>
        body {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 3rem;
            padding: 2rem;
            border: 1px solid var(--theme-border-primary);
            border-radius: var(--radius-lg);
            background: var(--theme-bg-secondary);
        }
        .test-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--theme-text-primary);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--theme-text-primary);
        }
    </style>
</head>
<body>
    <h1>Teste do Emoji Picker</h1>
    
    <div class="test-section">
        <h2 class="test-title">1. Campo simples com emoji obrigat√≥rio</h2>
        <div class="form-group">
            <label class="form-label" for="tema-juridico">Nome do Tema Jur√≠dico</label>
            <input 
                type="text" 
                id="tema-juridico" 
                class="form-control"
                placeholder="Ex: ‚öñÔ∏è Direito Trabalhista"
                maxlength="27"
            >
            <div class="form-error" id="tema-juridico-error"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">2. Linha Narrativa com emoji</h2>
        <div class="form-group">
            <label class="form-label" for="linha-narrativa">Linha Narrativa</label>
            <input 
                type="text" 
                id="linha-narrativa" 
                class="form-control"
                placeholder="Ex: üéØ Foco em Resultados"
                maxlength="27"
            >
            <div class="form-error" id="linha-narrativa-error"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">3. Campo sem emoji (normal)</h2>
        <div class="form-group">
            <label class="form-label" for="descricao">Descri√ß√£o</label>
            <input 
                type="text" 
                id="descricao" 
                class="form-control"
                placeholder="Descri√ß√£o normal sem emoji"
            >
        </div>
    </div>
    
    <div class="test-section">
        <h2 class="test-title">4. Valida√ß√£o em tempo real</h2>
        <div class="form-group">
            <label class="form-label" for="teste-validacao">Campo com valida√ß√£o</label>
            <input 
                type="text" 
                id="teste-validacao" 
                class="form-control"
                placeholder="Ex: üí° Texto aqui"
                maxlength="27"
            >
            <div class="form-error" id="teste-validacao-error"></div>
        </div>
        <button type="button" id="validar-btn" class="btn btn-primary">Validar</button>
    </div>

    <script type="module">
        import { behaviors } from '/js/components/ui/behaviors.js';
        import { EmojiPicker } from '/js/components/ui/EmojiPicker.js';
        import { validators } from '/js/components/forms/validators.js';

        // Inicializar emoji pickers
        async function init() {
            try {
                console.log('Iniciando configura√ß√£o dos emoji pickers...');
                
                // Campos que devem come√ßar com emoji
                const temaJuridicoInput = document.getElementById('tema-juridico');
                const linhaNarrativaInput = document.getElementById('linha-narrativa');
                const testeValidacaoInput = document.getElementById('teste-validacao');

                console.log('Elementos encontrados:', {
                    temaJuridicoInput: !!temaJuridicoInput,
                    linhaNarrativaInput: !!linhaNarrativaInput,
                    testeValidacaoInput: !!testeValidacaoInput
                });

                // Adicionar emoji pickers
                console.log('Adicionando emoji picker ao tema jur√≠dico...');
                new EmojiPicker(temaJuridicoInput, {
                    onChange: (emoji) => {
                        console.log('Emoji selecionado para tema jur√≠dico:', emoji);
                    }
                });

                console.log('Adicionando emoji picker √† linha narrativa...');
                new EmojiPicker(linhaNarrativaInput, {
                    onChange: (emoji) => {
                        console.log('Emoji selecionado para linha narrativa:', emoji);
                    }
                });

                console.log('Adicionando emoji picker ao teste de valida√ß√£o...');
                new EmojiPicker(testeValidacaoInput);

                console.log('Emoji pickers inicializados com sucesso!');
            } catch (error) {
                console.error('Erro ao inicializar emoji pickers:', error);
            }

            // Valida√ß√£o em tempo real para todos os campos
            [temaJuridicoInput, linhaNarrativaInput, testeValidacaoInput].forEach(input => {
                input.addEventListener('input', () => {
                    const value = input.value;
                    const error = validators.startsWithEmoji(value);
                    const errorDiv = document.getElementById(input.id + '-error');
                    
                    if (errorDiv) {
                        errorDiv.textContent = error || '';
                        input.classList.toggle('is-invalid', !!error);
                        input.classList.toggle('is-valid', !error && value);
                    }
                    
                    // Log para debug
                    console.log(`Campo ${input.id}:`, {
                        value,
                        length: value.length,
                        error,
                        valid: !error && value
                    });
                });
            });

            // Bot√£o de valida√ß√£o
            document.getElementById('validar-btn').addEventListener('click', () => {
                const inputs = [
                    { input: temaJuridicoInput, errorId: 'tema-juridico-error' },
                    { input: linhaNarrativaInput, errorId: 'linha-narrativa-error' },
                    { input: testeValidacaoInput, errorId: 'teste-validacao-error' }
                ];

                inputs.forEach(({ input, errorId }) => {
                    const value = input.value;
                    const error = validators.startsWithEmoji(value);
                    const errorDiv = document.getElementById(errorId);
                    
                    errorDiv.textContent = error || '';
                    input.classList.toggle('is-invalid', !!error);
                    input.classList.toggle('is-valid', !error && value);

                    if (error) {
                        behaviors.shake(input);
                    }
                });
            });

            console.log('Emoji pickers inicializados!');
        }

        // Inicializar quando a p√°gina carregar
        init().catch(console.error);
    </script>
</body>
</html>